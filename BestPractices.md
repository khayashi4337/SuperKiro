# Best Practices

大規模プロジェクト、特にレガシーシステムの移行・刷新で役立つ知見をまとめています。

---

## 段階的な進め方

### Phase/Stage/SubStageの活用

大規模プロジェクトは一気に進めようとすると破綻します。階層的に分解することで:

- **Phase**: 大きなマイルストーン（例: 現状分析、設計、移行、検証）
- **Stage**: 目的別の作業単位（例: 技術調査、リスク評価）
- **SubStage**: 具体的なタスク群（例: フレームワーク依存の洗い出し）

各階層で「インプット → タスク → アウトプット」を明確にすることで、進捗が可視化され、引き継ぎも容易になります。

### 現在位置の追跡

`steering/current-stage.md` を常に最新に保つことで:

- AIが「今どこにいるか」を把握できる
- チームメンバーが状況を一目で理解できる
- 中断・再開がスムーズになる

---

## 回帰テスト

### Stage毎のテスト実施を推奨

大規模移行では、**各Stage完了時に回帰テストを実施**することを強く推奨します。

```
Phase 1: 現状分析
  └── Stage 1: 技術調査 → テスト計画策定
  └── Stage 2: リスク評価 → テストケース優先度決定

Phase 2: 移行
  └── Stage 1: 基盤移行 → 回帰テスト実施 ✅
  └── Stage 2: 機能移行 → 回帰テスト実施 ✅
  └── Stage 3: 統合    → 回帰テスト実施 ✅
```

**なぜStage毎か？**

- 問題の早期発見（後になるほど原因特定が困難）
- 影響範囲の限定（どのStageで壊れたか明確）
- 心理的安全性（「ここまでは動く」という確信）

### AS-IS behavior の活用

`artifacts/as-is-behavior.md` に現行システムの入出力を記録しておくと、回帰テストの期待値として活用できます。

---

## AS-IS ドキュメントの重要性

### ソースと動作、両方を記録する

| ドキュメント | 内容 | 注意点 |
|--------------|------|--------|
| `as-is-source.md` | ソースコードから読み取った仕様 | コードが正しいとは限らない |
| `as-is-behavior.md` | 実際の動作テスト結果 | **これが真の仕様** |

レガシーシステムでは「ソースの意図」と「実際の動作」が乖離していることが珍しくありません。**動作が正**です。

### 信頼できない情報源への対処

外部から提供されたドキュメントやソースコードが「最新」と言われても、鵜呑みにしないでください:

- 必ず動作確認で検証
- 差異があれば `as-is-behavior.md` に記録
- 情報源の信頼度をメモしておく

---

## 技術的負債との向き合い方

### 負債は避けられない

大規模移行では、技術的負債を完全に避けることは現実的ではありません。重要なのは:

1. **認識すること**: 「これは負債だ」と明示的に記録
2. **管理すること**: どこかにリストアップしておく
3. **計画すること**: いつ返済するか目処を立てる

### 負債の記録方法

`docs/troubleshooting/` や `output.md` に以下のように記録:

```markdown
## 技術的負債

### [負債名]
- 内容: 何を妥協したか
- 理由: なぜ今は対応しないか
- 影響: 放置するとどうなるか
- 返済計画: いつ、どのPhase/Stageで対応するか
```

### 負債を恐れすぎない

> 「完璧な移行」より「動く移行」

負債を恐れて進めないより、記録しながら前に進む方が価値があります。ただし、**セキュリティに関わる負債**は別です。これは妥協せず即座に対応してください。

---

## ドキュメントの心構え

### 書かれたドキュメント > 完璧なドキュメント

- 「あとで書く」は書かれない
- 雑でもいいから今書く
- 30%の完成度でも0%より無限に価値がある

### 情報の鮮度

- 古い情報より「情報がない」方がマシな場合もある
- 日付を必ず入れる（`YYYY-MM-DD`）
- 定期的に見直し、陳腐化したものは削除またはアーカイブ

### 検索可能性

- ファイル名は具体的に（`error.md` より `prisma-connection-pool-exhausted.md`）
- タグやカテゴリを活用
- 関連ドキュメントへのリンクを貼る

---

## あとがき

大規模システムの移行は、技術的な挑戦であると同時に、**知識管理の挑戦**でもあります。

チームが得た知見を適切に記録・共有することで:

- 同じ問題を二度調べない
- 同じ指摘を二度受けない
- 後から参加したメンバーも追いつける

SuperKiroは、この「知識管理」を支援するためのフレームワークです。完璧を目指さず、まずは使い始めてください。使いながら、チームに合った形にカスタマイズしていくことが、最も効果的な導入方法です。

> 「解決したらすぐ書く」を習慣にする。それだけで、チームの生産性は確実に上がります。
